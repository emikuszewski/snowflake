<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlainID Snowflake Authorizer - Technical Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0066cc;
            --code-bg: #1e293b;
            --border: #e2e8f0;
            --text: #334155;
            --sidebar-bg: #f8fafc;
            --accent: #059669;
            --warning: #dc2626;
            --info: #0284c7;
            --main-bg: #ffffff;
            --box-bg: #ffffff;
            --table-header-bg: #f8fafc;
            --flow-bg-start: #f8fafc;
            --flow-bg-end: #e2e8f0;
            --svg-text: white;
        }

        [data-theme="dark"] {
            --primary: #4d94ff;
            --code-bg: #0f172a;
            --border: #334155;
            --text: #cbd5e1;
            --sidebar-bg: #1e293b;
            --accent: #10b981;
            --warning: #ef4444;
            --info: #38bdf8;
            --main-bg: #0f172a;
            --box-bg: #1e293b;
            --table-header-bg: #334155;
            --flow-bg-start: #1e293b;
            --flow-bg-end: #334155;
            --svg-text: #cbd5e1;
        }

        body {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            line-height: 1.6;
            color: var(--text);
            display: flex;
            height: 100vh;
            overflow: hidden;
            background: var(--main-bg);
        }

        /* Dark Mode Toggle */
        .theme-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
            background: var(--box-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .theme-toggle svg {
            width: 24px;
            height: 24px;
            fill: var(--text);
        }

        .theme-toggle .sun {
            display: none;
        }

        [data-theme="dark"] .theme-toggle .moon {
            display: none;
        }

        [data-theme="dark"] .theme-toggle .sun {
            display: block;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            padding: 2rem 1rem;
        }

        .sidebar h3 {
            font-size: 0.875rem;
            text-transform: uppercase;
            color: #94a3b8;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .sidebar ul {
            list-style: none;
            margin-bottom: 1.5rem;
        }

        .sidebar li {
            margin: 0.25rem 0;
        }

        .sidebar a {
            color: var(--text);
            text-decoration: none;
            font-size: 0.875rem;
            padding: 0.25rem 0.5rem;
            display: block;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .sidebar a:hover,
        .sidebar a.active {
            background: white;
            color: var(--primary);
        }

        /* Main Content */
        .main {
            flex: 1;
            overflow-y: auto;
            padding: 2rem 3rem;
            max-width: 1000px;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        h2 {
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        h3 {
            font-size: 1.125rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--primary);
        }

        p {
            margin-bottom: 1rem;
            line-height: 1.7;
        }

        /* Code Block */
        .code {
            background: var(--code-bg);
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 6px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .code-inline {
            background: #f1f5f9;
            padding: 0.125rem 0.25rem;
            border-radius: 3px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.875rem;
            color: var(--primary);
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.875rem;
        }

        th, td {
            text-align: left;
            padding: 0.75rem;
            border: 1px solid var(--border);
        }

        th {
            background: var(--sidebar-bg);
            font-weight: 600;
        }

        tbody tr {
            background: var(--box-bg);
        }

        tbody tr:hover {
            background: var(--sidebar-bg);
        }

        /* Alert */
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            border-left: 4px solid;
        }

        .alert.info {
            background: #eff6ff;
            border-color: var(--info);
        }

        .alert.warning {
            background: #fef2f2;
            border-color: var(--warning);
        }

        .alert.success {
            background: #f0fdf4;
            border-color: var(--accent);
        }

        /* Architecture Diagram */
        .architecture {
            background: var(--box-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 2rem;
            margin: 1.5rem 0;
            text-align: center;
        }

        .flow {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 2rem 0;
            gap: 1rem;
        }

        .component {
            background: var(--sidebar-bg);
            border: 2px solid var(--border);
            padding: 1rem;
            border-radius: 6px;
            flex: 1;
            font-size: 0.875rem;
        }

        .component.primary {
            border-color: var(--primary);
            background: var(--box-bg);
        }

        [data-theme="dark"] .component.primary {
            background: #1e3a5f;
        }

        .arrow {
            color: var(--primary);
            font-size: 1.5rem;
        }

        /* Visual Flow Diagrams */
        .flow-visual {
            background: linear-gradient(135deg, var(--flow-bg-start) 0%, var(--flow-bg-end) 100%);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            position: relative;
            overflow: hidden;
        }

        .flow-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            position: relative;
            z-index: 2;
        }

        .flow-node {
            background: var(--box-bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem 1rem;
            text-align: center;
            position: relative;
            transition: all 0.3s;
            cursor: pointer;
        }

        .flow-node:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }

        .flow-node.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 102, 204, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 102, 204, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 102, 204, 0); }
        }

        .flow-node-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .flow-node-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        .flow-node-desc {
            font-size: 0.75rem;
            color: #64748b;
            line-height: 1.3;
        }

        .flow-node.active .flow-node-desc {
            color: rgba(255,255,255,0.9);
        }

        /* Connection Lines */
        .flow-connections {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .flow-line {
            stroke: var(--primary);
            stroke-width: 2;
            fill: none;
            stroke-dasharray: 5, 5;
            animation: dash 20s linear infinite;
        }

        @keyframes dash {
            to { stroke-dashoffset: -100; }
        }

        .flow-line.active {
            stroke-width: 3;
            stroke: var(--accent);
            stroke-dasharray: none;
        }

        /* Sequence Diagram */
        .sequence-diagram {
            background: var(--box-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 2rem;
            margin: 2rem 0;
            overflow-x: auto;
        }

        .sequence-actors {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3rem;
            position: relative;
        }

        .actor {
            background: var(--primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            text-align: center;
            min-width: 120px;
            position: relative;
        }

        .actor::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            width: 2px;
            height: 400px;
            background: var(--border);
            transform: translateX(-50%);
        }

        .sequence-messages {
            position: relative;
            height: 400px;
        }

        .message {
            position: absolute;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: #f8fafc;
            border-radius: 4px;
            font-size: 0.875rem;
            white-space: nowrap;
            transition: all 0.3s;
        }

        .message:hover {
            background: #eff6ff;
            transform: scale(1.05);
        }

        .message-arrow {
            width: 100px;
            height: 2px;
            background: var(--primary);
            position: relative;
        }

        .message-arrow::after {
            content: '▶';
            position: absolute;
            right: -10px;
            top: -8px;
            color: var(--primary);
        }

        /* Data Flow Animation */
        .data-flow-visual {
            background: #0f172a;
            border-radius: 12px;
            padding: 3rem;
            margin: 2rem 0;
            position: relative;
            min-height: 400px;
            overflow: hidden;
        }

        .flow-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #60a5fa;
            border-radius: 50%;
            animation: flowAnimation 4s linear infinite;
            box-shadow: 0 0 10px rgba(96, 165, 250, 0.5);
        }

        @keyframes flowAnimation {
            0% { left: 10%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { left: 90%; opacity: 0; }
        }

        .flow-step {
            display: flex;
            align-items: center;
            margin: 2rem 0;
            position: relative;
            z-index: 2;
        }

        .flow-step-number {
            background: var(--primary);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .flow-step-content {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            padding: 1rem;
            color: white;
            flex: 1;
        }

        .flow-step-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .flow-step-desc {
            font-size: 0.875rem;
            color: rgba(255,255,255,0.7);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border);
            margin: 1rem 0;
        }

        .tab {
            padding: 0.5rem 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            color: var(--text);
            transition: all 0.2s;
        }

        .tab.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
            margin-bottom: -2px;
        }

        .tab-content {
            display: none;
            padding: 1rem 0;
        }

        .tab-content.active {
            display: block;
        }

        /* List */
        ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        li {
            margin: 0.5rem 0;
        }

        /* API Endpoint */
        .endpoint {
            background: var(--sidebar-bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .method {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }

        .method.post { background: #10b981; color: white; }
        .method.get { background: #3b82f6; color: white; }
        .method.put { background: #f59e0b; color: white; }
        .method.delete { background: #ef4444; color: white; }
    </style>
</head>
<body>
    <!-- Dark Mode Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
            <circle cx="12" cy="12" r="5" fill="currentColor"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
    </button>

    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <h3>Architecture</h3>
        <ul>
            <li><a href="#overview" class="active">System Overview</a></li>
            <li><a href="#components">Core Components</a></li>
            <li><a href="#data-flow">Data Flow</a></li>
        </ul>

        <h3>Configuration</h3>
        <ul>
            <li><a href="#paa-setup">PAA Setup</a></li>
            <li><a href="#pip-config">PIP Configuration</a></li>
            <li><a href="#pdp-config">PDP Configuration</a></li>
            <li><a href="#snowflake-integration">Snowflake Integration</a></li>
        </ul>

        <h3>Authorization Patterns</h3>
        <ul>
            <li><a href="#policy-resolution">Policy Resolution</a></li>
            <li><a href="#data-masking">Data Masking</a></li>
            <li><a href="#row-filtering">Row-Level Filtering</a></li>
            <li><a href="#column-access">Column Access Control</a></li>
        </ul>

        <h3>API Reference</h3>
        <ul>
            <li><a href="#permit-deny">Permit/Deny API</a></li>
            <li><a href="#policy-api">Policy Resolution API</a></li>
            <li><a href="#token-api">Access Token API</a></li>
        </ul>

        <h3>Deployment</h3>
        <ul>
            <li><a href="#helm">Helm Deployment</a></li>
            <li><a href="#standalone">Standalone Installation</a></li>
            <li><a href="#caching">Caching Strategy</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <h1>PlainID Snowflake Data Authorizer</h1>
        <p>Technical documentation for implementing Policy-Based Access Control (PBAC) in Snowflake Data Cloud environments.</p>

        <div class="alert info">
            <strong>Version:</strong> PlainID Platform 2024.1 | <strong>Pattern:</strong> Data Access Authorization | <strong>Requirements:</strong> Snowflake Enterprise+
        </div>
        
        <div class="alert warning">
            <strong>Documentation Status:</strong> PlainID announced Snowflake Authorizer support in December 2024. Some implementation details are based on PlainID's documented patterns for data authorizers. Contact PlainID support for production deployment guidance.
        </div>

        <!-- System Overview -->
        <section id="overview">
            <h2>System Overview</h2>
            <p>The PlainID Snowflake Authorizer implements fine-grained authorization through Policy Resolution endpoints, providing dynamic data access control at query execution time.</p>

            <!-- Main Authorization Flow Visual -->
            <div class="flow-visual">
                <h3 style="margin-bottom: 2rem;">End-to-End Authorization Flow</h3>
                <div class="flow-container">
                    <div class="flow-node" onclick="highlightStep(1)">
                        <div class="flow-node-icon">👤</div>
                        <div class="flow-node-title">User Query</div>
                        <div class="flow-node-desc">User executes SELECT on Snowflake table</div>
                    </div>
                    <div class="flow-node" onclick="highlightStep(2)">
                        <div class="flow-node-icon">❄️</div>
                        <div class="flow-node-title">Snowflake</div>
                        <div class="flow-node-desc">Triggers external authorization function</div>
                    </div>
                    <div class="flow-node" onclick="highlightStep(3)">
                        <div class="flow-node-icon">🔐</div>
                        <div class="flow-node-title">PlainID PDP</div>
                        <div class="flow-node-desc">Evaluates policies & resolves attributes</div>
                    </div>
                    <div class="flow-node" onclick="highlightStep(4)">
                        <div class="flow-node-icon">✅</div>
                        <div class="flow-node-title">Decision</div>
                        <div class="flow-node-desc">Returns filtered/masked result set</div>
                    </div>
                </div>
                <div style="width: 100%; height: 50px; margin-top: 15px; position: relative;">
                    <svg viewBox="0 0 800 50" style="width: 100%; height: 100%;">
                        <defs>
                            <marker id="arrowhead-flow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
                                <polygon points="0 0, 10 3, 0 6" fill="#0066cc"/>
                            </marker>
                        </defs>
                        <path class="flow-line" d="M 100 5 Q 200 35, 300 5" marker-end="url(#arrowhead-flow)"/>
                        <path class="flow-line" d="M 300 5 Q 400 35, 500 5" marker-end="url(#arrowhead-flow)"/>
                        <path class="flow-line" d="M 500 5 Q 600 35, 700 5" marker-end="url(#arrowhead-flow)"/>
                    </svg>
                </div>
            </div>

            <!-- Sequence Diagram -->
            <div class="sequence-diagram">
                <h3>Detailed Authorization Sequence</h3>
                <div class="sequence-actors">
                    <div class="actor">User</div>
                    <div class="actor">Snowflake</div>
                    <div class="actor">PlainID PAA</div>
                    <div class="actor">PDP</div>
                    <div class="actor">PIP</div>
                </div>
                <div class="sequence-messages">
                    <div class="message" style="top: 20px; left: 50px;">
                        <span>1. SQL Query</span>
                        <div class="message-arrow"></div>
                    </div>
                    <div class="message" style="top: 60px; left: 200px;">
                        <span>2. Call External Function</span>
                        <div class="message-arrow"></div>
                    </div>
                    <div class="message" style="top: 100px; left: 380px;">
                        <span>3. Authorization Request</span>
                        <div class="message-arrow"></div>
                    </div>
                    <div class="message" style="top: 140px; left: 500px;">
                        <span>4. Get Attributes</span>
                        <div class="message-arrow"></div>
                    </div>
                    <div class="message" style="top: 180px; left: 500px; flex-direction: row-reverse;">
                        <div class="message-arrow" style="transform: rotate(180deg);"></div>
                        <span>5. User Context</span>
                    </div>
                    <div class="message" style="top: 220px; left: 380px; flex-direction: row-reverse;">
                        <div class="message-arrow" style="transform: rotate(180deg);"></div>
                        <span>6. Policy Decision</span>
                    </div>
                    <div class="message" style="top: 260px; left: 200px; flex-direction: row-reverse;">
                        <div class="message-arrow" style="transform: rotate(180deg);"></div>
                        <span>7. Apply Filters/Masks</span>
                    </div>
                    <div class="message" style="top: 300px; left: 50px; flex-direction: row-reverse;">
                        <div class="message-arrow" style="transform: rotate(180deg);"></div>
                        <span>8. Filtered Results</span>
                    </div>
                </div>
            </div>

            <div class="architecture">
                <h3>Component Architecture</h3>
                <div class="flow">
                    <div class="component">
                        <strong>PAP</strong><br>
                        Policy Administration
                    </div>
                    <span class="arrow">→</span>
                    <div class="component primary">
                        <strong>PAA</strong><br>
                        Policy Agent
                    </div>
                    <span class="arrow">→</span>
                    <div class="component">
                        <strong>PDP</strong><br>
                        Decision Point
                    </div>
                    <span class="arrow">→</span>
                    <div class="component">
                        <strong>Snowflake</strong><br>
                        Enforcement
                    </div>
                </div>
            </div>

            <h3>Key Capabilities</h3>
            <ul>
                <li>Real-time authorization decisions with sub-millisecond latency</li>
                <li>Native Snowflake security integration via external functions</li>
                <li>Policy Resolution for complex data filtering scenarios</li>
                <li>Dynamic attribute resolution through PIP service</li>
                <li>Distributed caching with Redis for performance optimization</li>
            </ul>
        </section>

        <!-- Core Components -->
        <section id="components">
            <h2>Core Components</h2>
            
            <!-- Complete System Architecture Visual -->
            <div class="data-flow-visual" style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);">
                <h3 style="color: white; text-align: center; margin-bottom: 2rem;">PlainID + Snowflake Integration Architecture</h3>
                
                <svg viewBox="0 0 900 600" style="width: 100%; height: auto;">
                    <!-- Define gradients and filters -->
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#60a5fa"/>
                        </marker>
                        <marker id="arrowhead-orange" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#f59e0b"/>
                        </marker>
                        <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                            <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.2"/>
                        </filter>
                    </defs>
                    
                    <!-- PlainID Cloud Section -->
                    <g id="plainid-cloud">
                        <rect x="50" y="50" width="350" height="180" rx="12" fill="#0066cc" opacity="0.15" stroke="#0066cc" stroke-width="2"/>
                        <text x="225" y="85" fill="white" text-anchor="middle" font-size="18" font-weight="bold">PlainID Cloud</text>
                        
                        <!-- PAP Box -->
                        <rect x="80" y="120" width="100" height="70" rx="6" fill="#ffffff" stroke="#0066cc" stroke-width="2" filter="url(#shadow)"/>
                        <text x="130" y="160" text-anchor="middle" font-size="14" font-weight="bold">PAP</text>
                        
                        <!-- Policy Store Box -->
                        <rect x="220" y="120" width="120" height="70" rx="6" fill="#ffffff" stroke="#0066cc" stroke-width="2" filter="url(#shadow)"/>
                        <text x="280" y="150" text-anchor="middle" font-size="14" font-weight="bold">Policy Store</text>
                        <text x="280" y="170" text-anchor="middle" font-size="11" fill="#64748b">Repository</text>
                    </g>
                    
                    <!-- Customer Environment Section -->
                    <g id="customer-env">
                        <rect x="50" y="300" width="800" height="250" rx="12" fill="#059669" opacity="0.1" stroke="#059669" stroke-width="2"/>
                        <text x="450" y="325" fill="#059669" text-anchor="middle" font-size="13" opacity="0.7">Customer Environment</text>
                        
                        <!-- PAA Box -->
                        <rect x="100" y="380" width="140" height="100" rx="6" fill="#ffffff" stroke="#059669" stroke-width="2" filter="url(#shadow)"/>
                        <text x="170" y="410" text-anchor="middle" font-size="16" font-weight="bold">PAA</text>
                        <line x1="110" y1="420" x2="230" y2="420" stroke="#e2e8f0" stroke-width="1"/>
                        <text x="170" y="445" text-anchor="middle" font-size="13">PDP</text>
                        <text x="170" y="465" text-anchor="middle" font-size="13">PIP</text>
                        
                        <!-- Redis Cache Box -->
                        <rect x="300" y="380" width="100" height="100" rx="6" fill="#ffffff" stroke="#dc2626" stroke-width="2" filter="url(#shadow)"/>
                        <text x="350" y="420" text-anchor="middle" font-size="16" font-weight="bold">Redis</text>
                        <text x="350" y="445" text-anchor="middle" font-size="12" fill="#64748b">Cache</text>
                        
                        <!-- Snowflake Box -->
                        <rect x="500" y="360" width="280" height="140" rx="6" fill="#ffffff" stroke="#0284c7" stroke-width="2" filter="url(#shadow)"/>
                        <text x="640" y="395" text-anchor="middle" font-size="18" font-weight="bold">❄️ Snowflake</text>
                        <line x1="520" y1="405" x2="760" y2="405" stroke="#e2e8f0" stroke-width="1"/>
                        <text x="640" y="430" text-anchor="middle" font-size="13">External Functions</text>
                        <text x="640" y="450" text-anchor="middle" font-size="13">Row Access Policies</text>
                        <text x="640" y="470" text-anchor="middle" font-size="13">Masking Policies</text>
                    </g>
                    
                    <!-- User Icon -->
                    <g id="user">
                        <circle cx="640" cy="150" r="35" fill="#ffffff" stroke="#0066cc" stroke-width="2" filter="url(#shadow)"/>
                        <text x="640" y="160" text-anchor="middle" font-size="24">👤</text>
                        <text x="640" y="210" fill="white" text-anchor="middle" font-size="14" font-weight="bold">User</text>
                    </g>
                    
                    <!-- Connection Lines -->
                    <g id="connections">
                        <!-- Policy Sync: PAP to PAA -->
                        <path d="M 130 190 Q 130 285 170 380" stroke="#60a5fa" stroke-width="2" stroke-dasharray="5,5" fill="none"/>
                        <text x="90" y="285" fill="#60a5fa" font-size="13">Policy Sync</text>
                        
                        <!-- PAA to Redis -->
                        <line x1="240" y1="430" x2="300" y2="430" stroke="#60a5fa" stroke-width="2" marker-end="url(#arrowhead)"/>
                        
                        <!-- Redis to Snowflake -->
                        <line x1="400" y1="430" x2="500" y2="430" stroke="#60a5fa" stroke-width="2" marker-end="url(#arrowhead)"/>
                        <text x="450" y="445" fill="#60a5fa" font-size="13" text-anchor="middle">Authorize</text>
                        
                        <!-- User to Snowflake -->
                        <path d="M 640 185 L 640 360" stroke="#60a5fa" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
                        <text x="655" y="270" fill="#60a5fa" font-size="13">SQL Query</text>
                        
                        <!-- Snowflake to PAA - Authorization Request -->
                        <path d="M 500 400 Q 350 280 240 400" stroke="#f59e0b" stroke-width="2" stroke-dasharray="3,3" fill="none" marker-end="url(#arrowhead-orange)"/>
                        <text x="355" y="365" fill="#f59e0b" font-size="12" text-anchor="middle">1st Auth Check</text>
                    </g>
                </svg>
            </div>
            
            <h3>Policy Authorization Agent (PAA)</h3>
            <p>Hybrid component deployed in customer environment, manages PDP and PIP services.</p>
            
            <div class="code">
# PAA Configuration Structure
apiVersion: plainid.io/v1
kind: PolicyAuthorizationAgent
metadata:
  name: snowflake-paa
  agentId: ${AGENT_ID}
spec:
  deployment:
    type: hybrid
    components:
      - pdp
      - pip
  connection:
    tenant: ${TENANT_ID}
    secretKey: ${AGENT_SECRET_KEY}</div>

            <h3>Policy Decision Point (PDP)</h3>
            <table>
                <tr>
                    <th>Component</th>
                    <th>Function</th>
                    <th>Configuration</th>
                </tr>
                <tr>
                    <td>Decision Engine</td>
                    <td>Evaluates policies against request context</td>
                    <td><span class="code-inline">pdp.engine.threads=10</span></td>
                </tr>
                <tr>
                    <td>Cache Layer</td>
                    <td>Redis-based decision caching</td>
                    <td><span class="code-inline">pdp.cache.ttl=300</span></td>
                </tr>
                <tr>
                    <td>Load Balancer</td>
                    <td>Distributes requests across PDP instances</td>
                    <td><span class="code-inline">pdp.replicas=3</span></td>
                </tr>
            </table>

            <h3>Policy Information Point (PIP)</h3>
            <p>Provides attribute resolution from external data sources for authorization decisions.</p>
            
            <div class="code">
// PIP View Configuration
{
  "viewName": "snowflake_user_attributes",
  "dataSources": [
    {
      "type": "JDBC",
      "adapter": "snowflake",
      "connectionString": "jdbc:snowflake://${ACCOUNT}.snowflakecomputing.com",
      "query": "SELECT user_id, department, clearance_level FROM user_attributes"
    }
  ],
  "cache": {
    "type": "persistent",
    "refreshInterval": 3600
  }
}</div>
        </section>

        <!-- Data Flow -->
        <section id="data-flow">
            <h2>Data Flow</h2>
            
            <!-- Animated Data Flow Visual -->
            <div class="data-flow-visual">
                <h3 style="color: white; margin-bottom: 2rem;">Real-Time Authorization Data Flow</h3>
                
                <div class="flow-step">
                    <div class="flow-step-number">1</div>
                    <div class="flow-step-content">
                        <div class="flow-step-title">Query Initiation</div>
                        <div class="flow-step-desc">User executes: SELECT * FROM sales_data WHERE region='US'</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="flow-step-number">2</div>
                    <div class="flow-step-content">
                        <div class="flow-step-title">Authorization Intercept</div>
                        <div class="flow-step-desc">Snowflake calls plainid_authorize(user, 'sales_data', 'SELECT')</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="flow-step-number">3</div>
                    <div class="flow-step-content">
                        <div class="flow-step-title">Context Enrichment</div>
                        <div class="flow-step-desc">PIP fetches user attributes: department, clearance_level, projects</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="flow-step-number">4</div>
                    <div class="flow-step-content">
                        <div class="flow-step-title">Policy Evaluation</div>
                        <div class="flow-step-desc">PDP evaluates: Can user in 'Finance' see 'US' sales with clearance level 2?</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="flow-step-number">5</div>
                    <div class="flow-step-content">
                        <div class="flow-step-title">Decision & Enforcement</div>
                        <div class="flow-step-desc">Returns: PERMIT with obligations - mask SSN, filter by user's territories</div>
                    </div>
                </div>
                
                <!-- Animated particles -->
                <div class="flow-particle" style="animation-delay: 0s; top: 80px;"></div>
                <div class="flow-particle" style="animation-delay: 0.8s; top: 150px;"></div>
                <div class="flow-particle" style="animation-delay: 1.6s; top: 220px;"></div>
                <div class="flow-particle" style="animation-delay: 2.4s; top: 290px;"></div>
                <div class="flow-particle" style="animation-delay: 3.2s; top: 360px;"></div>
            </div>
            
            <div class="tabs">
                <button class="tab active" onclick="showTab('query-flow')">Query Authorization</button>
                <button class="tab" onclick="showTab('policy-sync')">Policy Synchronization</button>
                <button class="tab" onclick="showTab('attribute-resolution')">Attribute Resolution</button>
            </div>

            <div id="query-flow" class="tab-content active">
                <h3>Query Authorization Flow</h3>
                
                <!-- Visual Flow Diagram for Query -->
                <div class="flow-visual">
                    <div class="flow-container">
                        <div class="flow-node">
                            <div class="flow-node-icon">📊</div>
                            <div class="flow-node-title">SQL Query</div>
                            <div class="flow-node-desc">SELECT * FROM customers</div>
                        </div>
                        <div class="flow-node">
                            <div class="flow-node-icon">🔍</div>
                            <div class="flow-node-title">Parse Request</div>
                            <div class="flow-node-desc">Extract user, table, action</div>
                        </div>
                        <div class="flow-node">
                            <div class="flow-node-icon">⚖️</div>
                            <div class="flow-node-title">Evaluate</div>
                            <div class="flow-node-desc">Check policies & context</div>
                        </div>
                        <div class="flow-node">
                            <div class="flow-node-icon">🎭</div>
                            <div class="flow-node-title">Transform</div>
                            <div class="flow-node-desc">Apply masks & filters</div>
                        </div>
                    </div>
                </div>
                
                <div class="alert warning">
                    <strong>Implementation Note:</strong> The following Snowflake SQL examples are illustrative. Actual implementation details may vary based on your PlainID configuration and Snowflake setup. Consult PlainID support for production implementations.
                </div>

                <div class="code">
-- Example: Snowflake External Function Pattern (Illustrative)
-- Actual syntax depends on your PlainID deployment
CREATE OR REPLACE EXTERNAL FUNCTION plainid_authorize(
    user_id VARCHAR,
    resource VARCHAR,
    action VARCHAR
)
RETURNS VARIANT
API_INTEGRATION = plainid_integration
AS 'https://your-paa-endpoint/api/v1/policy/resolution';</div>
            </div>

            <div id="policy-sync" class="tab-content">
                <h3>Policy Synchronization</h3>
                
                <!-- Policy Sync Visual -->
                <div class="flow-visual">
                    <div class="flow-container">
                        <div class="flow-node">
                            <div class="flow-node-icon">📝</div>
                            <div class="flow-node-title">Policy Update</div>
                            <div class="flow-node-desc">Admin modifies policy in PAP</div>
                        </div>
                        <div class="flow-node">
                            <div class="flow-node-icon">🔔</div>
                            <div class="flow-node-title">Webhook Trigger</div>
                            <div class="flow-node-desc">Notify PAA of changes</div>
                        </div>
                        <div class="flow-node">
                            <div class="flow-node-icon">📡</div>
                            <div class="flow-node-title">Redis Publish</div>
                            <div class="flow-node-desc">Broadcast to all PDPs</div>
                        </div>
                        <div class="flow-node">
                            <div class="flow-node-icon">🔄</div>
                            <div class="flow-node-title">Cache Update</div>
                            <div class="flow-node-desc">Invalidate & refresh cache</div>
                        </div>
                    </div>
                </div>
                
                <div class="code">
# Policy Sync Configuration
sync:
  method: webhook
  endpoint: https://paa.example.com/policy/sync
  authentication:
    type: oauth2
    clientId: ${CLIENT_ID}
    clientSecret: ${CLIENT_SECRET}
  notification:
    redis:
      channel: policy-updates
      keyspace: notify-keyspace-events</div>
            </div>

            <div id="attribute-resolution" class="tab-content">
                <h3>Attribute Resolution Process</h3>
                
                <!-- PIP Flow Visual -->
                <div class="flow-visual">
                    <div class="flow-container">
                        <div class="flow-node">
                            <div class="flow-node-icon">🔑</div>
                            <div class="flow-node-title">Identity</div>
                            <div class="flow-node-desc">User: john@company.com</div>
                        </div>
                        <div class="flow-node">
                            <div class="flow-node-icon">🗂️</div>
                            <div class="flow-node-title">LDAP Lookup</div>
                            <div class="flow-node-desc">Dept: Finance, Level: 3</div>
                        </div>
                        <div class="flow-node">
                            <div class="flow-node-icon">🏢</div>
                            <div class="flow-node-title">HR System</div>
                            <div class="flow-node-desc">Projects: [P1, P2, P3]</div>
                        </div>
                        <div class="flow-node">
                            <div class="flow-node-icon">🎯</div>
                            <div class="flow-node-title">Context Ready</div>
                            <div class="flow-node-desc">Complete user profile</div>
                        </div>
                    </div>
                </div>
                
                <ul>
                    <li><strong>Identity Attributes:</strong> User roles, departments, clearance levels</li>
                    <li><strong>Resource Attributes:</strong> Data classification, ownership, sensitivity</li>
                    <li><strong>Environmental Attributes:</strong> Time, location, network zone</li>
                </ul>
            </div>
        </section>

        <!-- PAA Setup -->
        <section id="paa-setup">
            <h2>PAA Setup</h2>
            
            <h3>Installation Methods</h3>
            <div class="alert info">
                PAA can be deployed using Helm charts (recommended) or standalone installation. Download the installation bundle from PlainID Platform.
            </div>

            <h3>Helm Deployment (Verified Configuration)</h3>
            <div class="code">
# Download PAA bundle from PlainID Platform
# Extract the helm chart package
tar -xzf plainid-paa-helm.tar.gz
cd plainid-paa

# Configure custom-values.yaml with your settings
helm install snowflake-paa . \
  --namespace plainid \
  --create-namespace \
  --values custom-values.yaml</div>

            <h3>Required Environment Variables</h3>
            <table>
                <tr>
                    <th>Variable</th>
                    <th>Description</th>
                    <th>Source</th>
                </tr>
                <tr>
                    <td><span class="code-inline">tenantId</span></td>
                    <td>PlainID tenant identifier</td>
                    <td>Tenant Settings UI</td>
                </tr>
                <tr>
                    <td><span class="code-inline">agentSecretKey</span></td>
                    <td>PAA authentication key</td>
                    <td>Hybrid Agent Keys tab</td>
                </tr>
                <tr>
                    <td><span class="code-inline">paaId</span></td>
                    <td>Policy Authorization Agent ID</td>
                    <td>Policy Authorization Agents tab</td>
                </tr>
            </table>
            
            <div class="alert warning">
                <strong>Important:</strong> Redis is required for PAA operation. Use an external managed Redis instance for production environments.
            </div>
        </section>

        <!-- PIP Configuration -->
        <section id="pip-config">
            <h2>PIP Configuration</h2>
            
            <h3>Data Source Adapters</h3>
            <p>Configure adapters for attribute resolution from Snowflake and other sources.</p>

            <div class="code">
// Snowflake JDBC Adapter
{
  "adapter": {
    "name": "snowflake-prod",
    "type": "JDBC",
    "configuration": {
      "driver": "net.snowflake.client.jdbc.SnowflakeDriver",
      "url": "jdbc:snowflake://${ACCOUNT}.snowflakecomputing.com",
      "warehouse": "COMPUTE_WH",
      "database": "USER_DATA",
      "schema": "ATTRIBUTES",
      "authentication": {
        "type": "oauth",
        "tokenEndpoint": "${TOKEN_ENDPOINT}"
      }
    }
  }
}</div>

            <h3>View Definitions</h3>
            <div class="code">
// User Attributes View
CREATE VIEW user_enrichment AS
SELECT 
    u.user_id,
    u.email,
    d.department_name,
    d.cost_center,
    r.role_name,
    r.permissions
FROM users u
JOIN departments d ON u.dept_id = d.id
JOIN roles r ON u.role_id = r.id
WHERE u.active = true;</div>

            <h3>Caching Configuration</h3>
            <table>
                <tr>
                    <th>Cache Type</th>
                    <th>Use Case</th>
                    <th>TTL</th>
                </tr>
                <tr>
                    <td>Persistent</td>
                    <td>Static reference data</td>
                    <td>3600s</td>
                </tr>
                <tr>
                    <td>In-Memory</td>
                    <td>Frequently accessed attributes</td>
                    <td>300s</td>
                </tr>
                <tr>
                    <td>No Cache</td>
                    <td>Real-time sensitive data</td>
                    <td>0s</td>
                </tr>
            </table>
        </section>

        <!-- Policy Resolution -->
        <section id="policy-resolution">
            <h2>Policy Resolution Pattern</h2>
            
            <div class="alert info">
                <strong>Note:</strong> Policy Resolution is PlainID's documented pattern for data authorization. This endpoint is specifically designed for data use cases including Snowflake integration.
            </div>
            
            <h3>Request Structure</h3>
            <div class="endpoint">
                <span class="method post">POST</span>
                <span class="code-inline">/api/v1/policy/resolution</span>
            </div>

            <div class="code">
{
  "identity": {
    "type": "user",
    "id": "john.doe@example.com"
  },
  "scope": {
    "name": "snowflake-prod"
  },
  "assetType": {
    "type": "table",
    "database": "ANALYTICS",
    "schema": "SALES"
  },
  "action": "SELECT",
  "context": {
    "ip": "10.0.1.50",
    "time": "2024-01-15T10:30:00Z"
  }
}</div>

            <h3>Response Structure</h3>
            <div class="code">
{
  "decision": "PERMIT",
  "access": {
    "columns": ["customer_id", "order_date", "amount"],
    "denied": ["ssn", "credit_card"]
  },
  "privileges": {
    "filters": [
      {
        "column": "region",
        "operator": "IN",
        "values": ["US_EAST", "US_WEST"]
      }
    ],
    "masks": [
      {
        "column": "email",
        "function": "partial_mask",
        "params": {"show_last": 4}
      }
    ]
  }
}</div>

            <h3>Policy Definition</h3>
            <div class="code">
{
  "policy": {
    "name": "snowflake-data-governance",
    "rules": [
      {
        "id": "pii-protection",
        "effect": "MASK",
        "target": {
          "resource": "column:*/pii/*",
          "subjects": ["role:analyst"]
        },
        "condition": "user.clearance_level < 3",
        "action": {
          "type": "mask",
          "function": "hash"
        }
      }
    ]
  }
}</div>
            
            <div class="alert success">
                <strong>Best Practice:</strong> Policy Resolution is recommended for data use cases where the expected number of assets returned per call is more than 1000. This pattern supports row-level and column-level filtering.
            </div>
        </section>

        <!-- Data Masking -->
        <section id="data-masking">
            <h2>Data Masking Configuration</h2>
            
            <h3>PlainID Masking Functions (Documented)</h3>
            <table>
                <tr>
                    <th>Function</th>
                    <th>Description</th>
                    <th>Example Output</th>
                </tr>
                <tr>
                    <td><span class="code-inline">partial_mask</span></td>
                    <td>Shows only part of the value</td>
                    <td>john****@example.com</td>
                </tr>
                <tr>
                    <td><span class="code-inline">hash</span></td>
                    <td>One-way hash function</td>
                    <td>a1b2c3d4...</td>
                </tr>
                <tr>
                    <td><span class="code-inline">tokenize</span></td>
                    <td>Reversible tokenization</td>
                    <td>TKN_12345</td>
                </tr>
                <tr>
                    <td><span class="code-inline">redact</span></td>
                    <td>Complete removal</td>
                    <td>[REDACTED]</td>
                </tr>
                <tr>
                    <td><span class="code-inline">k-anonymization</span></td>
                    <td>Statistical privacy protection</td>
                    <td>Generalized value</td>
                </tr>
            </table>

            <h3>Integration Pattern</h3>
            <p>PlainID's Policy Resolution endpoint returns masking instructions that should be applied to query results. The enforcement happens through the Data Authorizer pattern.</p>
            
            <div class="alert info">
                <strong>How it Works:</strong> PlainID evaluates policies and returns masking functions in the Policy Resolution response. Your integration layer applies these masks to the data before returning results to users.
            </div>

            <div class="code">
// Example Policy Resolution Response with Masking
{
  "privileges": {
    "masks": [
      {
        "column": "email",
        "function": "partial_mask",
        "params": {"show_last": 4}
      },
      {
        "column": "ssn",
        "function": "redact"
      }
    ]
  }
}</div>
        </section>

        <!-- Row Filtering -->
        <section id="row-filtering">
            <h2>Row-Level Security</h2>
            
            <h3>PlainID Row Filtering Pattern</h3>
            <p>PlainID provides row-level filtering through the Policy Resolution endpoint. The response includes filter conditions that should be applied to queries.</p>
            
            <div class="code">
// Policy Resolution Response with Row Filters
{
  "privileges": {
    "filters": [
      {
        "column": "region",
        "operator": "IN",
        "values": ["US_EAST", "US_WEST"]
      },
      {
        "column": "department",
        "operator": "=",
        "value": "Finance"
      }
    ]
  }
}</div>

            <h3>Implementation Approach</h3>
            <div class="alert info">
                <strong>Data Authorizer Pattern:</strong> PlainID's Data Authorizers use the Policy Resolution endpoint to determine which rows a user can access. The filters are then applied at the query level, either through middleware or native database features.
            </div>
            
            <ul>
                <li><strong>Column-Level Access:</strong> Controls which columns are returned in the query</li>
                <li><strong>Row-Level Filtering:</strong> Adds WHERE clause conditions based on policies</li>
                <li><strong>Cell-Level Security:</strong> Combines row filters with column masking</li>
            </ul>

            <div class="alert warning">
                <strong>Performance Consideration:</strong> Complex row filters may impact query performance. PlainID recommends using caching strategies and optimizing PDP response times. Cache duration is configurable per scope.
            </div>
        </section>

        <!-- Helm Deployment -->
        <section id="helm">
            <h2>Helm Deployment (Verified Configuration)</h2>
            
            <h3>Custom Values Configuration</h3>
            <div class="code">
# custom-values.yaml
# Values obtained from PlainID Platform UI
global:
  tenantId: "your-tenant-id"  # From Tenant Settings
  agentSecretKey: "your-secret-key"  # From Hybrid Agent Keys tab
  paaId: "your-paa-id"  # From Policy Authorization Agents tab

pdp:
  replicas: 3
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

# External Redis recommended for production
redis:
  enabled: false  # Disable if using external Redis
  external:
    host: "your-redis-endpoint"
    port: 6379

pip:
  enabled: true
  dataSources:
    - name: snowflake
      type: jdbc
      adapter: "net.snowflake.client.jdbc.SnowflakeDriver"

# OAuth configuration for PIP data sources
pipOperator:
  plainIDConfig:
    auth-config.xml: |
      <?xml version='1.0'?>
      <policy xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="urn:jboss:security-config:5.0"
              xmlns="urn:jboss:security-config:5.0">
        <!-- OAuth configuration for data sources -->
      </policy></div>

            <h3>Deployment Commands</h3>
            <div class="code">
# Create namespace
kubectl create namespace plainid

# Install PAA with custom values
helm install snowflake-paa ./plainid-paa \
  --namespace plainid \
  --values custom-values.yaml \
  --wait

# Verify deployment
kubectl get pods -n plainid
kubectl logs -f deployment/snowflake-paa-pdp -n plainid</div>
            
            <div class="alert success">
                <strong>Note:</strong> Redis cluster mode is not currently supported. Use standalone or HA Redis configurations.
            </div>
        </section>

        <!-- Caching Strategy -->
        <section id="caching">
            <h2>Caching Strategy (Documented Configuration)</h2>
            
            <h3>Cache Layers</h3>
            <div class="architecture">
                <div class="flow">
                    <div class="component">
                        <strong>Identity Cache</strong><br>
                        Duration in seconds<br>
                        <small>User attributes</small>
                    </div>
                    <span class="arrow">→</span>
                    <div class="component primary">
                        <strong>Scope Cache</strong><br>
                        Duration in minutes<br>
                        <small>Access decisions</small>
                    </div>
                    <span class="arrow">→</span>
                    <div class="component">
                        <strong>PIP Cache</strong><br>
                        Persistent/In-Memory<br>
                        <small>External data</small>
                    </div>
                </div>
            </div>

            <h3>Cache Configuration</h3>
            <div class="code">
# Identity Cache (configured in seconds)
# Path: Identity Workspace Settings > Attribute sources > Cache Duration
identity.cache.duration=1800  # 30 minutes

# Scope Cache (configured in minutes)  
# Path: Environment Settings > Scopes > Cache Duration
scope.cache.duration=5  # 5 minutes

# PIP Cache Options
pip.cache.type=persistent  # or in-memory
pip.cache.refreshInterval=3600  # 1 hour

# Redis Configuration (required)
redis.notify-keyspace-events=true  # For PAA sync</div>

            <h3>Cache Types</h3>
            <table>
                <tr>
                    <th>Cache Type</th>
                    <th>Use Case</th>
                    <th>Configuration</th>
                </tr>
                <tr>
                    <td>Persistent Cache</td>
                    <td>Static reference data</td>
                    <td>Stored in database, survives restarts</td>
                </tr>
                <tr>
                    <td>In-Memory Cache</td>
                    <td>Frequently accessed attributes</td>
                    <td>Fast access, cleared on restart</td>
                </tr>
                <tr>
                    <td>No Cache</td>
                    <td>Real-time sensitive data</td>
                    <td>Cache duration = 0</td>
                </tr>
            </table>

            <div class="alert success">
                <strong>Best Practice:</strong> Use identity caching when attributes like job title, department, location don't change frequently. Set cache duration based on data volatility.
            </div>
        </section>

        <!-- API Reference -->
        <section id="permit-deny">
            <h2>Permit/Deny API</h2>
            
            <div class="endpoint">
                <span class="method post">POST</span>
                <span class="code-inline">/api/v1/authorize/permit-deny</span>
            </div>

            <h3>Request</h3>
            <div class="code">
curl -X POST https://paa.example.com/api/v1/authorize/permit-deny \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer ${TOKEN}" \
  -d '{
    "subject": "user:john.doe",
    "resource": "snowflake:db:analytics:table:sales",
    "action": "SELECT",
    "context": {
      "ip": "10.0.1.50",
      "mfa": true
    }
  }'</div>

            <h3>Response</h3>
            <div class="code">
{
  "decision": "PERMIT",
  "obligations": [
    {
      "type": "mask",
      "columns": ["ssn", "credit_card"]
    }
  ],
  "ttl": 300
}</div>
        </section>

        <div class="alert info" style="margin-top: 3rem;">
            <strong>Documentation Based On:</strong> PlainID Official Documentation (docs.plainid.io)<br>
            <strong>Last Updated:</strong> January 2025<br>
            <strong>Note:</strong> Specific Snowflake implementation details may vary. For production deployments, contact PlainID Technical Support.
        </div>
        
        <div style="text-align: center; margin-top: 4rem; padding: 2rem 0; border-top: 1px solid var(--border); color: var(--text); opacity: 0.5; font-size: 0.75rem;">
            Made by the SE Team • For Walkthrough Purposes Only
        </div>
    </main>

    <script>
        // Dark Mode Toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // Load saved theme preference on page load
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();

        // Tab functionality
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Highlight flow steps
        function highlightStep(step) {
            document.querySelectorAll('.flow-node').forEach((node, index) => {
                node.classList.remove('active');
                if (index < step) {
                    node.style.opacity = '0.5';
                } else if (index === step - 1) {
                    node.classList.add('active');
                    node.style.opacity = '1';
                } else {
                    node.style.opacity = '1';
                }
            });
            
            // Animate the flow lines
            document.querySelectorAll('.flow-line').forEach((line, index) => {
                if (index < step - 1) {
                    line.classList.add('active');
                } else {
                    line.classList.remove('active');
                }
            });
        }

        // Auto-animate flow on page load
        let currentStep = 1;
        const maxSteps = 4;
        
        function animateFlow() {
            highlightStep(currentStep);
            currentStep++;
            if (currentStep > maxSteps) {
                currentStep = 1;
            }
        }
        
        // Start animation
        setInterval(animateFlow, 2000);

        // Navigation highlighting
        document.querySelectorAll('.sidebar a').forEach(link => {
            link.addEventListener('click', function(e) {
                document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // Add hover effects to sequence diagram messages
        document.querySelectorAll('.message').forEach(msg => {
            msg.addEventListener('mouseenter', function() {
                this.style.zIndex = '10';
                this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
            });
            msg.addEventListener('mouseleave', function() {
                this.style.zIndex = '1';
                this.style.boxShadow = 'none';
            });
        });
    </script>
</body>
</html>
